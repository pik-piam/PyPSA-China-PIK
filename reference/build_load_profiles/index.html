
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../build_cutout/">
      
      
        <link rel="next" href="../build_population/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Build load profiles - PyPSA China Model (PIK edition) Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#build_load_profiles" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyPSA China Model (PIK edition) Documentation" class="md-header__button md-logo" aria-label="PyPSA China Model (PIK edition) Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyPSA China Model (PIK edition) Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Build load profiles
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyPSA China Model (PIK edition) Documentation" class="md-nav__button md-logo" aria-label="PyPSA China Model (PIK edition) Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyPSA China Model (PIK edition) Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to the PyPSA-China (PIK version) documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SUMMARY
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_brownfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add brownfield
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_electricity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add electricity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_existing_baseyear/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add existing baseyear
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_biomass_potential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build biomass potential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_cop_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build cop profiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_cutout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build cutout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Build load profiles
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Build load profiles
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      build_load_profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_daily_heat_demand_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      build_daily_heat_demand_profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_heat_demand_profile" class="md-nav__link">
    <span class="md-ellipsis">
      build_heat_demand_profile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_hot_water_per_day" class="md-nav__link">
    <span class="md-ellipsis">
      build_hot_water_per_day
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.downscale_time_data" class="md-nav__link">
    <span class="md-ellipsis">
      downscale_time_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.make_heat_demand_projections" class="md-nav__link">
    <span class="md-ellipsis">
      make_heat_demand_projections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.prepare_hourly_load_data" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_hourly_load_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.project_elec_demand" class="md-nav__link">
    <span class="md-ellipsis">
      project_elec_demand
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_population/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build population
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_population_gridcell_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build population gridcell map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_province_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build province shapes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_renewable_potential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build renewable potential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_renewable_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build renewable profiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_solar_thermal_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build solar thermal profiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_temperature_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build temperature profiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../determine_availability_matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Determine availability matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetch_rasters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fetch rasters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetch_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fetch shapes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../make_summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Make summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_heatmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot heatmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_input_costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot input costs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_inputs_visualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot inputs visualisation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_network_heat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot network heat
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_summary_all/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot summary all
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_time_series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot time series
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_base_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare base network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_base_network_2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare base network 2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_existing_capacities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare existing capacities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_network_common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare network common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Readers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readers_geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Readers geospatial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solve_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solve network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solve_network_myopic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solve network myopic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_39" >
        
          
          <label class="md-nav__link" for="__nav_3_39" id="__nav_3_39_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Remind coupling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_39_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_39">
            <span class="md-nav__icon md-icon"></span>
            Remind coupling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/disaggregate_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disaggregate data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/generic_etl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generic etl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/make_pypsa_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Make pypsa config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      build_load_profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_daily_heat_demand_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      build_daily_heat_demand_profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_heat_demand_profile" class="md-nav__link">
    <span class="md-ellipsis">
      build_heat_demand_profile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.build_hot_water_per_day" class="md-nav__link">
    <span class="md-ellipsis">
      build_hot_water_per_day
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.downscale_time_data" class="md-nav__link">
    <span class="md-ellipsis">
      downscale_time_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.make_heat_demand_projections" class="md-nav__link">
    <span class="md-ellipsis">
      make_heat_demand_projections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.prepare_hourly_load_data" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_hourly_load_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_load_profiles.project_elec_demand" class="md-nav__link">
    <span class="md-ellipsis">
      project_elec_demand
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Build load profiles</h1>

<div class="doc doc-object doc-module">



<a id="build_load_profiles"></a>
    <div class="doc doc-contents first">

        <p>Functions for the rules to build the hourly heat and load demand profiles
- electricity load profiles are based on scaling an hourly base year profile to yearly future
    projections
- daily heating demand is based on the degree day approx (from atlite) &amp; upscaled hourly based
  on an intraday profile (for Denmark by default, see snakefile)</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.build_daily_heat_demand_profiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_daily_heat_demand_profiles</span><span class="p">(</span><span class="n">heat_demand_config</span><span class="p">,</span> <span class="n">atlite_heating_hr_shift</span><span class="p">,</span> <span class="n">switch_month_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>build the heat demand profile according to forecast demans</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>heat_demand_config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the heat demand configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atlite_heating_hr_shift</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hour shift for heating demand, needed due to imperfect
timezone handling in atlite</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>switch_month_day</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to switch month &amp; day from heat_demand_config.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pd.DataFrame: regional daily heating demand with April to Sept forced to 0</p>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_daily_heat_demand_profiles</span><span class="p">(</span>
    <span class="n">heat_demand_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">atlite_heating_hr_shift</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">switch_month_day</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;build the heat demand profile according to forecast demans</span>

<span class="sd">    Args:</span>
<span class="sd">        heat_demand_config (dict): the heat demand configuration</span>
<span class="sd">        atlite_heating_hr_shift (int): the hour shift for heating demand, needed due to imperfect</span>
<span class="sd">            timezone handling in atlite</span>
<span class="sd">        switch_month_day (bool, optional): whether to switch month &amp; day from heat_demand_config.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: regional daily heating demand with April to Sept forced to 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">population_map</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="n">pop_map</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;population_gridcell_map&quot;</span><span class="p">]</span>

    <span class="n">cutout</span> <span class="o">=</span> <span class="n">atlite</span><span class="o">.</span><span class="n">Cutout</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">cutout</span><span class="p">)</span>
    <span class="n">atlite_year</span> <span class="o">=</span> <span class="n">get_cutout_params</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">config</span><span class="p">)[</span><span class="s2">&quot;weather_year&quot;</span><span class="p">]</span>

    <span class="n">pop_matrix</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">pop_map</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">pop_map</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;provinces&quot;</span>

    <span class="c1"># TODO clarify a bit here, maybe the po_matrix should be normalised earlier?</span>
    <span class="c1"># unclear whether it&#39;s per cap or not</span>
    <span class="n">total_hd</span> <span class="o">=</span> <span class="n">cutout</span><span class="o">.</span><span class="n">heat_demand</span><span class="p">(</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">pop_matrix</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;heating_start_temp&quot;</span><span class="p">],</span>
        <span class="n">a</span><span class="o">=</span><span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;heating_lin_slope&quot;</span><span class="p">],</span>
        <span class="n">constant</span><span class="o">=</span><span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;heating_offet&quot;</span><span class="p">],</span>
        <span class="c1"># hack to bring it back to local from UTC</span>
        <span class="n">hour_shift</span><span class="o">=</span><span class="n">atlite_heating_hr_shift</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">regonal_daily_hd</span> <span class="o">=</span> <span class="n">total_hd</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">pop_map</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="c1"># input given as dd-mm but loc as yyyy-mm-dd</span>
    <span class="k">if</span> <span class="n">switch_month_day</span><span class="p">:</span>
        <span class="n">start_day</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;start_day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">end_day</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;end_day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_day</span> <span class="o">=</span> <span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;start_day&quot;</span><span class="p">]</span>
        <span class="n">end_day</span> <span class="o">=</span> <span class="n">heat_demand_config</span><span class="p">[</span><span class="s2">&quot;end_day&quot;</span><span class="p">]</span>
    <span class="n">regonal_daily_hd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atlite_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">start_day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atlite_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">regonal_daily_hd</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.build_heat_demand_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_heat_demand_profile</span><span class="p">(</span><span class="n">daily_hd</span><span class="p">,</span> <span class="n">hot_water_per_day</span><span class="p">,</span> <span class="n">snapshots</span><span class="p">,</span> <span class="n">planning_horizons</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Downscale the daily heat demand to hourly heat demand using pre-defined intraday profiles
THIS FUNCTION ALSO MAKES PROJECTIONS FOR HEATING DEMAND - WHICH IS NOT THE CORRECT PLACE</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>daily_hd</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the day resolved heat demand for each region (atlite time axis)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hot_water_per_day</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the day resolved hot water demand for each region</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>snapshots</code>
            </td>
            <td>
                  <code><span title="pandas.date_range">date_range</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the snapshots for the planning year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>planning_horizons</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the planning year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>, <span title="object">object</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[pd.DataFrame, pd.DataFrame, object, pd.DataFrame]:
heat, space_heat, space_heating_per_hdd, water_heat demands</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_heat_demand_profile</span><span class="p">(</span>
    <span class="n">daily_hd</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">hot_water_per_day</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">snapshots</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">,</span>
    <span class="n">planning_horizons</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downscale the daily heat demand to hourly heat demand using pre-defined intraday profiles</span>
<span class="sd">    THIS FUNCTION ALSO MAKES PROJECTIONS FOR HEATING DEMAND - WHICH IS NOT THE CORRECT PLACE</span>

<span class="sd">    Args:</span>
<span class="sd">        daily_hd (DataFrame): the day resolved heat demand for each region (atlite time axis)</span>
<span class="sd">        hot_water_per_day (DataFrame): the day resolved hot water demand for each region</span>
<span class="sd">        snapshots (pd.date_range): the snapshots for the planning year</span>
<span class="sd">        planning_horizons (int | str): the planning year</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[pd.DataFrame, pd.DataFrame, object, pd.DataFrame]:</span>
<span class="sd">            heat, space_heat, space_heating_per_hdd, water_heat demands</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - very strange, why would this be needed unless atlite is buggy</span>
    <span class="n">daily_hd_uniq</span> <span class="o">=</span> <span class="n">daily_hd</span><span class="p">[</span><span class="o">~</span><span class="n">daily_hd</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)]</span>
    <span class="c1"># hourly resolution regional demand (but wrong data, it&#39;s just ffill)</span>
    <span class="n">heat_demand_hourly</span> <span class="o">=</span> <span class="n">shift_profile_to_planning_year</span><span class="p">(</span>
        <span class="n">daily_hd_uniq</span><span class="p">,</span> <span class="n">planning_yr</span><span class="o">=</span><span class="n">planning_horizons</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">snapshots</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>

    <span class="c1"># ===== downscale to hourly =======</span>
    <span class="n">intraday_profiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">intraday_profiles</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># TODO, does this work with variable frequency?</span>
    <span class="n">intraday_year_profiles</span> <span class="o">=</span> <span class="n">downscale_time_data</span><span class="p">(</span>
        <span class="n">dt_index</span><span class="o">=</span><span class="n">heat_demand_hourly</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">weekly_profile</span><span class="o">=</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">intraday_profiles</span><span class="p">[</span><span class="s2">&quot;weekday&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">intraday_profiles</span><span class="p">[</span><span class="s2">&quot;weekend&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">),</span>
        <span class="n">regional_tzs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">PROV_NAMES</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">REGIONAL_GEO_TIMEZONES</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
    <span class="p">)</span>

    <span class="c1"># TWh -&gt; MWh</span>
    <span class="n">space_heat_demand_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">space_heat_demand</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>
    <span class="n">space_heat_demand_total</span> <span class="o">=</span> <span class="n">space_heat_demand_total</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># ==== SCALE TO FUTURE DEMAND ======</span>
    <span class="c1"># TODO soft-code ref/base year or find a better variable name</span>
    <span class="c1"># TODO remind coupling: fix this kind of stuff or make separate fn</span>
    <span class="c1"># Belongs outside of this function really and in main</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">make_heat_demand_projections</span><span class="p">(</span>
        <span class="n">planning_horizons</span><span class="p">,</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="p">[</span><span class="s2">&quot;heating_demand&quot;</span><span class="p">],</span> <span class="n">ref_year</span><span class="o">=</span><span class="n">REF_YEAR</span>
    <span class="p">)</span>
    <span class="c1"># WOULD BE NICER TO SUM THAN TO WEIGH OR TO directly build the profile with the freq</span>
    <span class="c1"># TODO, does this work with variable frequency?</span>
    <span class="n">space_heating_per_hdd</span> <span class="o">=</span> <span class="p">(</span><span class="n">space_heat_demand_total</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">heat_demand_hourly</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;snapshots&quot;</span><span class="p">][</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">space_heat_demand</span> <span class="o">=</span> <span class="n">intraday_year_profiles</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">heat_demand_hourly</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">space_heating_per_hdd</span><span class="p">)</span>
    <span class="n">water_heat_demand</span> <span class="o">=</span> <span class="n">intraday_year_profiles</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">hot_water_per_day</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>

    <span class="n">heat_demand</span> <span class="o">=</span> <span class="n">space_heat_demand</span> <span class="o">+</span> <span class="n">water_heat_demand</span>

    <span class="k">return</span> <span class="n">heat_demand</span><span class="p">,</span> <span class="n">space_heat_demand</span><span class="p">,</span> <span class="n">space_heating_per_hdd</span><span class="p">,</span> <span class="n">water_heat_demand</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.build_hot_water_per_day" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_hot_water_per_day</span><span class="p">(</span><span class="n">planning_horizons</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Make projections for the hot water demand increase and scale the ref year value
NB: the ref year value is for 2008 not 2020 -&gt; incorrect</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>planning_horizons</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the planning year to which demand will be projected</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the config projection type is not supported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Series: regional hot water demand per day</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_hot_water_per_day</span><span class="p">(</span><span class="n">planning_horizons</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make projections for the hot water demand increase and scale the ref year value</span>
<span class="sd">    NB: the ref year value is for 2008 not 2020 -&gt; incorrect</span>

<span class="sd">    Args:</span>
<span class="sd">        planning_horizons (int | str): the planning year to which demand will be projected</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the config projection type is not supported</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Series: regional hot water demand per day</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="n">population_count</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span>

    <span class="n">unit_hot_water_start_yr</span> <span class="o">=</span> <span class="n">UNIT_HOT_WATER_START_YEAR</span>
    <span class="n">unit_hot_water_end_yr</span> <span class="o">=</span> <span class="n">UNIT_HOT_WATER_END_YEAR</span>

    <span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="p">[</span><span class="s2">&quot;heating_demand&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">START_YEAR</span><span class="p">,</span> <span class="n">END_YEAR</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">unit_hot_water_start_yr</span><span class="p">,</span> <span class="n">unit_hot_water_end_yr</span><span class="p">])</span>
        <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">unit_hot_water</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">planning_horizons</span><span class="p">),</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="p">[</span><span class="s2">&quot;heating_demand&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
        <span class="n">unit_hot_water</span> <span class="o">=</span> <span class="n">unit_hot_water_start_yr</span>

    <span class="k">elif</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="p">[</span><span class="s2">&quot;heating_demand&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">lin_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">START_YEAR</span><span class="p">,</span> <span class="n">END_YEAR</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">unit_hot_water_start_yr</span><span class="p">,</span> <span class="n">unit_hot_water_end_yr</span><span class="p">])</span>
        <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">lin_func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">lin_func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">unit_hot_water</span> <span class="o">=</span> <span class="p">(</span><span class="n">lin_func</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">planning_horizons</span><span class="p">),</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span> <span class="o">+</span> <span class="n">UNIT_HOT_WATER_START_YEAR</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid heating demand type </span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="p">[</span><span class="s1">&#39;heating_demand&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># MWh per day per region</span>
    <span class="n">hot_water_per_day</span> <span class="o">=</span> <span class="n">unit_hot_water</span> <span class="o">*</span> <span class="n">population_count</span> <span class="o">/</span> <span class="mf">365.0</span>

    <span class="k">return</span> <span class="n">hot_water_per_day</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.downscale_time_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downscale_time_data</span><span class="p">(</span><span class="n">dt_index</span><span class="p">,</span> <span class="n">weekly_profile</span><span class="p">,</span> <span class="n">regional_tzs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Make hourly resolved data profiles based on exogenous weekdays and weekend profiles.
This fn takes into account that the profiles are in local time and that regions may
 have different timezones.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dt_index</code>
            </td>
            <td>
                  <code><span title="DatetimeIndex">DatetimeIndex</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the snapshots (in network local naive time) but hourly res.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weekly_profile</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the weekly profile as a list of 7*24 entries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regional_tzs</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regional geographical timezones for profiles.
Defaults to pd.Series(index=PROV_NAMES, data=list(REGIONAL_GEO_TIMEZONES.values())).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Regionally resolved profiles for each snapshot hour rperesented by dt_index</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">downscale_time_data</span><span class="p">(</span>
    <span class="n">dt_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
    <span class="n">weekly_profile</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">regional_tzs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make hourly resolved data profiles based on exogenous weekdays and weekend profiles.</span>
<span class="sd">    This fn takes into account that the profiles are in local time and that regions may</span>
<span class="sd">     have different timezones.</span>

<span class="sd">    Args:</span>
<span class="sd">        dt_index (DatetimeIndex): the snapshots (in network local naive time) but hourly res.</span>
<span class="sd">        weekly_profile (Iterable): the weekly profile as a list of 7*24 entries.</span>
<span class="sd">        regional_tzs (pd.Series, optional): regional geographical timezones for profiles.</span>
<span class="sd">            Defaults to pd.Series(index=PROV_NAMES, data=list(REGIONAL_GEO_TIMEZONES.values())).</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Regionally resolved profiles for each snapshot hour rperesented by dt_index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weekly_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">weekly_profile</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>
    <span class="c1"># make a dataframe with timestamps localized to the network TIMEZONE timestamps</span>
    <span class="n">all_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">PROV_NAMES</span><span class="p">,</span> <span class="p">[</span><span class="n">dt_index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">TIMEZONE</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">PROV_NAMES</span><span class="p">))),</span>
        <span class="n">index</span><span class="o">=</span><span class="n">dt_index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">TIMEZONE</span><span class="p">),</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">PROV_NAMES</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># then localize to regional time. _dt ensures index is not changed</span>
    <span class="n">week_hours</span> <span class="o">=</span> <span class="n">all_times</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">regional_tzs</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># then convert into week hour &amp; map to the intraday heat demand profile (based on local time)</span>
    <span class="k">return</span> <span class="n">week_hours</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">+</span> <span class="n">col</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">weekly_profile</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.make_heat_demand_projections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_heat_demand_projections</span><span class="p">(</span><span class="n">planning_year</span><span class="p">,</span> <span class="n">projection_name</span><span class="p">,</span> <span class="n">ref_year</span><span class="o">=</span><span class="n">REF_YEAR</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Make projections for heating demand</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>projection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of projection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>planning_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>year to project to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ref_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>reference year. Defaults to REF_YEAR.</p>
              </div>
            </td>
            <td>
                  <code><span title="constants.REF_YEAR">REF_YEAR</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>scaling factor relative to base year for heating demand</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_heat_demand_projections</span><span class="p">(</span>
    <span class="n">planning_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">projection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_year</span><span class="o">=</span><span class="n">REF_YEAR</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make projections for heating demand</span>

<span class="sd">    Args:</span>
<span class="sd">        projection_name (str): name of projection</span>
<span class="sd">        planning_year (int): year to project to</span>
<span class="sd">        ref_year (int, optional): reference year. Defaults to REF_YEAR.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: scaling factor relative to base year for heating demand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1985</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">1995</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2020</span><span class="p">,</span> <span class="mi">2060</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">projection_name</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Cubic polynomial fit to proj&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">d</span>

        <span class="c1"># TODO soft code</span>
        <span class="c1"># heated area projection in China</span>
        <span class="c1"># 2060: 6.02 * 36.52 * 1e4 north population * floor_space_per_capita in city</span>
        <span class="n">heated_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">2742</span><span class="p">,</span> <span class="mi">21263</span><span class="p">,</span> <span class="mi">64645</span><span class="p">,</span> <span class="mi">110766</span><span class="p">,</span> <span class="mi">252056</span><span class="p">,</span> <span class="mi">435668</span><span class="p">,</span> <span class="mi">672205</span><span class="p">,</span> <span class="mi">988209</span><span class="p">,</span> <span class="mi">2198504</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># 10000 m2</span>

        <span class="c1"># Perform curve fitting</span>
        <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">heated_area</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">planning_year</span><span class="p">),</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span> <span class="o">/</span> <span class="n">func</span><span class="p">(</span><span class="n">REF_YEAR</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">projection_name</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid heating demand projection </span><span class="si">{</span><span class="n">projection_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">factor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.prepare_hourly_load_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_hourly_load_data</span><span class="p">(</span><span class="n">hourly_load_p</span><span class="p">,</span> <span class="n">prov_codes_p</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read the hourly demand data and prepare it for use in the model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hourly_load_p</code>
            </td>
            <td>
                  <code><span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>raw elec data from zenodo, see readme in data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prov_codes_p</code>
            </td>
            <td>
                  <code><span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>province mapping for data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: the hourly demand data with the right province names, in TWh/hr</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_hourly_load_data</span><span class="p">(</span>
    <span class="n">hourly_load_p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span>
    <span class="n">prov_codes_p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the hourly demand data and prepare it for use in the model</span>

<span class="sd">    Args:</span>
<span class="sd">        hourly_load_p (os.PathLike, optional): raw elec data from zenodo, see readme in data.</span>
<span class="sd">        prov_codes_p (os.PathLike, optional): province mapping for data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: the hourly demand data with the right province names, in TWh/hr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TO_TWh</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="n">hourly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">hourly_load_p</span><span class="p">)</span>
    <span class="n">hourly_TWh</span> <span class="o">=</span> <span class="n">hourly</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time Series&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">TO_TWh</span>
    <span class="n">prov_codes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">prov_codes_p</span><span class="p">)</span>
    <span class="n">prov_codes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">hourly_TWh</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">hourly_TWh</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">prov_codes</span><span class="p">[</span><span class="s2">&quot;Full name&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">hourly_TWh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="build_load_profiles.project_elec_demand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">project_elec_demand</span><span class="p">(</span><span class="n">hourly_demand_base_yr_MWh</span><span class="p">,</span> <span class="n">yearly_projections_MWh</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>project the hourly demand to the future years</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hourly_demand_base_yr_MWh</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hourly demand in the base year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>yearly_projections_MWh</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the yearly projections</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: the projected hourly demand</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>workflow/scripts/build_load_profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">project_elec_demand</span><span class="p">(</span>
    <span class="n">hourly_demand_base_yr_MWh</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">yearly_projections_MWh</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;project the hourly demand to the future years</span>

<span class="sd">    Args:</span>
<span class="sd">        hourly_demand_base_yr_MWh (pd.DataFrame): the hourly demand in the base year</span>
<span class="sd">        yearly_projections_MWh (pd.DataFrame): the yearly projections</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: the projected hourly demand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hourly_load_profile</span> <span class="o">=</span> <span class="n">hourly_demand_base_yr_MWh</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">PROV_NAMES</span><span class="p">]</span>
    <span class="c1"># normalise the hourly load</span>
    <span class="n">hourly_load_profile</span> <span class="o">/=</span> <span class="n">hourly_load_profile</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">yearly_projections_MWh</span> <span class="o">=</span> <span class="n">yearly_projections_MWh</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">PROV_NAMES</span><span class="p">]</span>
    <span class="n">hourly_load_projected</span> <span class="o">=</span> <span class="n">yearly_projections_MWh</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">hourly_load_profile</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hourly_load_projected</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8784</span><span class="p">:</span>
        <span class="c1"># rm feb 29th</span>
        <span class="n">hourly_load_projected</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">hourly_load_projected</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1416</span><span class="p">:</span><span class="mi">1440</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">hourly_load_projected</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8760</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of the hourly load is not 8760 or 8784 (leap year, dropped)&quot;</span><span class="p">)</span>

    <span class="n">snapshots</span> <span class="o">=</span> <span class="n">make_periodic_snapshots</span><span class="p">(</span>
        <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;1h&quot;</span><span class="p">,</span>
        <span class="n">start_day_hour</span><span class="o">=</span><span class="s2">&quot;01-01 00:00:00&quot;</span><span class="p">,</span>
        <span class="n">end_day_hour</span><span class="o">=</span><span class="s2">&quot;12-31 23:00&quot;</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">hourly_load_projected</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">snapshots</span>
    <span class="k">return</span> <span class="n">hourly_load_projected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>