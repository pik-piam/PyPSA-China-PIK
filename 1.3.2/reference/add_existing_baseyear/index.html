
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pik-piam.github.io/PyPSA-China-PIK/1.3.2/reference/add_existing_baseyear/">
      
      
        <link rel="prev" href="../add_electricity/">
      
      
        <link rel="next" href="../add_sectors/">
      
      
        
      
      
      <link rel="icon" href="../../assets/img/pypsa_china.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Add existing baseyear - PyPSA China (PIK)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../docs/assets/styles/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#add_existing_baseyear" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyPSA China (PIK)" class="md-header__button md-logo" aria-label="PyPSA China (PIK)" data-md-component="logo">
      
  <img src="../../assets/img/logo_small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyPSA China (PIK)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Add existing baseyear
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pik-piam/PyPSA-China-PIK" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pik-piam/PyPSA-China-PIK
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../model/" class="md-tabs__link">
        
  
  
    
  
  Model

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../data/" class="md-tabs__link">
        
  
  
    
  
  Data

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/quick_start/" class="md-tabs__link">
        
  
  
    
  
  Setup

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../configuration/" class="md-tabs__link">
        
  
  
    
  
  Configuration

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../releases/" class="md-tabs__link">
        
  
  
    
  
  Releases

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/running/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../add_brownfield/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../release-guide/" class="md-tabs__link">
        
  
  
    
  
  Release Guide

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyPSA China (PIK)" class="md-nav__button md-logo" aria-label="PyPSA China (PIK)" data-md-component="logo">
      
  <img src="../../assets/img/logo_small.png" alt="logo">

    </a>
    PyPSA China (PIK)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pik-piam/PyPSA-China-PIK" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pik-piam/PyPSA-China-PIK
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/quick_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Releases
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/running/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running PyPSA-China
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/snakemake_tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snakemake Tips & Tricks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/coupling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coupling with REMIND
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_brownfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add brownfield
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_electricity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add electricity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Add existing baseyear
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Add existing baseyear
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_existing_baseyear
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.add_base_year" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_base_year
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_base_year">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add_existing_baseyear.add_base_year--all-extendable-components-now-have-build_year-2030" class="md-nav__link">
    <span class="md-ellipsis">
      
        All extendable components now have build_year = 2030
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.add_existing_vre_capacities" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_existing_vre_capacities
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.add_paid_off_capacity" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_paid_off_capacity
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.add_power_capacities_installed_before_baseyear" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_power_capacities_installed_before_baseyear
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.distribute_vre_by_grade" class="md-nav__link">
    <span class="md-ellipsis">
      
        distribute_vre_by_grade
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add_existing_baseyear.filter_brownfield_capacities" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_brownfield_capacities
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_sectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add sectors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_biomass_potential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build biomass potential
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_cop_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build cop profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_cutout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build cutout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_load_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build load profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_population/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build population
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_population_gridcell_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build population gridcell map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_powerplants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build powerplants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_province_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build province shapes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_renewable_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build renewable profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_solar_thermal_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build solar thermal profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_temperature_profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build temperature profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_transport_demand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build transport demand
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calculate_gebco_slope/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calculate gebco slope
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Constants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../determine_availability_matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Determine availability matrix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetch_rasters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fetch rasters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetch_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fetch shapes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../make_summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Make summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_input_costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot input costs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_inputs_visualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot inputs visualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_network_heat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot network heat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot statistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_summary_all/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot summary all
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_time_series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plot time series
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_existing_capacities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prepare existing capacities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prepare network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Readers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readers_geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Readers geospatial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SUMMARY
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solve_network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solve network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_37" >
        
          
          <label class="md-nav__link" for="__nav_8_37" id="__nav_8_37_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Remind coupling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_37_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_37">
            <span class="md-nav__icon md-icon"></span>
            
  
    Remind coupling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/disaggregate_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disaggregate data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/ev_refshare_extrapolator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ev refshare extrapolator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/extrapolate_regional_references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extrapolate regional references
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/generic_etl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generic etl
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/make_pypsa_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Make pypsa config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remind_coupling/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Guide
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Add existing baseyear</h1>

<div class="doc doc-object doc-module">



<a id="add_existing_baseyear"></a>
    <div class="doc doc-contents first">

        <p>Functions to add brownfield capacities to the network for a reference year
- adds VREs per grade and corrects technical potential. Best available grade is chosen</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.add_base_year" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_base_year</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">plan_year</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add base year information to newly built components in the network.</p>
<p>Sets the 'build_year' attribute for all extendable generators and links
in the network to the specified planning year. This is used to track
when infrastructure is added to the system.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="pypsa.Network">Network</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PyPSA network object to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plan_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The planning year to assign as the build year for new components.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This function modifies the network in-place by updating the 'build_year'
attribute for components marked as extendable (p_nom_extendable==True).</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>network = pypsa.Network()
add_base_year(network, 2030)</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="add_existing_baseyear.add_base_year--all-extendable-components-now-have-build_year-2030">All extendable components now have build_year = 2030</h3>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_base_year</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">,</span> <span class="n">plan_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add base year information to newly built components in the network.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Sets the &#39;build_year&#39; attribute for all extendable generators and links</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    in the network to the specified planning year. This is used to track</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    when infrastructure is added to the system.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        n: The PyPSA network object to modify.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        plan_year: The planning year to assign as the build year for new components.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        This function modifies the network in-place by updating the &#39;build_year&#39;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        attribute for components marked as extendable (p_nom_extendable==True).</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        &gt;&gt;&gt; network = pypsa.Network()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        &gt;&gt;&gt; add_base_year(network, 2030)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        # All extendable components now have build_year = 2030</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="s2">&quot;generators&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">comp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;p_nom_extendable==True&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;build_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plan_year</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.add_existing_vre_capacities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_existing_vre_capacities</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">vre_caps</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add existing VRE capacities to the network and distribute them by vre grade potential.
Adapted from pypsa-eur but the VRE capacities are province resolved.</p>
<p>NOTE that using this function requires adding the land-use constraint in solve_network so
  that the existing capacities are subtracted from the available potential</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="pypsa.Network">Network</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the network</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>costs</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>costs of the technologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vre_caps</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>existing brownfield VRE capacities in MW</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>snakemake configuration dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pd.DataFrame: DataFrame with existing VRE capacities distributed by CF grade</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_existing_vre_capacities</span><span class="p">(</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">n</span><span class="p">:</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">costs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">vre_caps</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Add existing VRE capacities to the network and distribute them by vre grade potential.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    Adapted from pypsa-eur but the VRE capacities are province resolved.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    NOTE that using this function requires adding the land-use constraint in solve_network so</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">      that the existing capacities are subtracted from the available potential</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        n (pypsa.Network): the network</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        costs (pd.DataFrame): costs of the technologies</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        vre_caps (pd.DataFrame): existing brownfield VRE capacities in MW</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        config (dict): snakemake configuration dictionary</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        pd.DataFrame: DataFrame with existing VRE capacities distributed by CF grade</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">tech_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;solar&quot;</span><span class="p">:</span> <span class="s2">&quot;PV&quot;</span><span class="p">,</span> <span class="s2">&quot;onwind&quot;</span><span class="p">:</span> <span class="s2">&quot;Onshore&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind-ac&quot;</span><span class="p">:</span> <span class="s2">&quot;Offshore&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">:</span> <span class="s2">&quot;Offshore&quot;</span><span class="p">}</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">tech_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">tech_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tech_map</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Techs&quot;</span><span class="p">][</span><span class="s2">&quot;vre_techs&quot;</span><span class="p">]}</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1"># historical data by tech, location and build year</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">grouped_vre</span> <span class="o">=</span> <span class="n">vre_caps</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Tech&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;DateIn&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">vre_df</span> <span class="o">=</span> <span class="n">grouped_vre</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># iterate over vre carriers</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="n">tech_map</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">vre_df</span><span class="p">[</span><span class="n">vre_df</span><span class="o">.</span><span class="n">Tech</span> <span class="o">==</span> <span class="n">carrier</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tech&quot;</span><span class="p">])</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1"># fetch existing vre generators (n grade bins per node)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">gen_i</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;carrier == @carrier&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">carrier_gens</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gen_i</span><span class="p">]</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">res_capacities</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1"># for each bus, distribute the vre capacities by grade potential - best first</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">for</span> <span class="n">bus</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">carrier_gens</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bus&quot;</span><span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">if</span> <span class="n">bus</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="k">continue</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">res_capacities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distribute_vre_by_grade</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">p_nom_max</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bus</span><span class="p">]))</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">if</span> <span class="n">res_capacities</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">res_capacities</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">res_capacities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">res_capacities</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                    <span class="n">bus_bin</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">carrier</span><span class="si">}</span><span class="s2">.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">gen</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                    <span class="n">bus</span><span class="p">,</span> <span class="n">bin_id</span> <span class="o">=</span> <span class="n">bus_bin</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bus_bin</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">carrier</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                    <span class="n">capacity</span> <span class="o">=</span> <span class="n">res_capacities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gen</span><span class="p">,</span> <span class="n">year</span><span class="p">]</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                    <span class="k">if</span> <span class="n">capacity</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                        <span class="n">cost_key</span> <span class="o">=</span> <span class="n">carrier</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Fueltype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">carrier</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">capacity</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;DateIn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;grouping_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cost_key</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">]</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;DateOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cost_key</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bus</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                        <span class="n">df_agg</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;resource_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_id</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">if</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">return</span> <span class="n">df_agg</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Tech&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">Fueltype</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">return</span> <span class="n">df_agg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.add_paid_off_capacity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_paid_off_capacity</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">paid_off_caps</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add capacities that have been paid off to the network. This is intended
for REMIND coupling, where (some of) the REMIND investments can be freely allocated
to the optimal node. NB: an additional constraing is needed to ensure that
the capacity is not exceeded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>network</code>
            </td>
            <td>
                  <code><span title="pypsa.Network">Network</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the network to which the capacities are added.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>paid_off_caps</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with paid off capacities &amp; columns
[tech_group, Capacity, techs]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>costs</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>techno-economic data for the technologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>minimum capacity to be considered. Defaults to 100 MW.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_paid_off_capacity</span><span class="p">(</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">network</span><span class="p">:</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">,</span> <span class="n">paid_off_caps</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">costs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="p">):</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">    Add capacities that have been paid off to the network. This is intended</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">    for REMIND coupling, where (some of) the REMIND investments can be freely allocated</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    to the optimal node. NB: an additional constraing is needed to ensure that</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    the capacity is not exceeded.</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">        network (pypsa.Network): the network to which the capacities are added.</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        paid_off_caps (pd.DataFrame): DataFrame with paid off capacities &amp; columns</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">            [tech_group, Capacity, techs]</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        costs (pd.DataFrame): techno-economic data for the technologies</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        cutoff (int, optional): minimum capacity to be considered. Defaults to 100 MW.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="n">paid_off</span> <span class="o">=</span> <span class="n">paid_off_caps</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="c1"># explode tech list per tech group (constraint will apply to group)</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="n">paid_off</span><span class="o">.</span><span class="n">techs</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">techs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_list</span><span class="p">)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="n">paid_off</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;techs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="n">paid_off</span><span class="p">[</span><span class="s2">&quot;carrier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">techs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="n">paid_off</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;carrier&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="c1"># clip small capacities</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="n">paid_off</span><span class="p">[</span><span class="s2">&quot;p_nom_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">cutoff</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">paid_off</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;techs&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="n">paid_off</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;p_nom_max &gt; 0&quot;</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">component_settings</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="s2">&quot;Generator&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="s2">&quot;join_col&quot;</span><span class="p">:</span> <span class="s2">&quot;carrier&quot;</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="s2">&quot;attrs_to_fix&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;p_min_pu&quot;</span><span class="p">,</span> <span class="s2">&quot;p_max_pu&quot;</span><span class="p">],</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="p">},</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="s2">&quot;Link&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="s2">&quot;join_col&quot;</span><span class="p">:</span> <span class="s2">&quot;carrier&quot;</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="s2">&quot;attrs_to_fix&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;p_min_pu&quot;</span><span class="p">,</span> <span class="s2">&quot;p_max_pu&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency2&quot;</span><span class="p">],</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="p">},</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="s2">&quot;Store&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="s2">&quot;join_col&quot;</span><span class="p">:</span> <span class="s2">&quot;carrier&quot;</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="s2">&quot;attrs_to_fix&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="p">},</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="p">}</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="c1"># TODO make a centralised setting or update cpl config</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="n">rename_carriers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;OCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;gas OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;CCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;gas CCGT&quot;</span><span class="p">}</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="n">paid_off</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rename_carriers</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">component_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;e&quot;</span> <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="s2">&quot;Store&quot;</span> <span class="k">else</span> <span class="s2">&quot;p&quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="n">paid_off_comp</span> <span class="o">=</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;p_nom_max&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_max&quot;</span><span class="p">})</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="c1"># exclude brownfield capacities</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">df</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">component</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_extendable == True&quot;</span><span class="p">)</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="c1"># join will add the tech_group and p_nom_max_rcl columns, used later for constraints</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="c1"># rcl is legacy name from Adrian for region country limit</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="n">paid</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paid_off_comp</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;join_col&quot;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s2">&quot;_rcl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="n">paid</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_max&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_max_rcl&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="n">paid</span> <span class="o">=</span> <span class="n">paid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">paid</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dropna</span><span class="p">()]</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="k">if</span> <span class="n">paid</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>            <span class="k">continue</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="c1"># REMIND cap is in output, PyPSA link in input</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="s2">&quot;Link&quot;</span><span class="p">:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="n">paid</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;p_nom_max_rcl&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">paid</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="n">paid</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="s2">&quot;_paid_off&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="c1"># set permissive options for the paid-off capacities (constraint per group added to model later)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="n">paid</span><span class="p">[</span><span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="n">paid</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="n">paid</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="n">paid</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nom_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="c1"># add to the network</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">paid</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">paid</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="c1"># now add the dynamic attributes not carried over by n.add (per unit avail etc)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="k">for</span> <span class="n">missing_attr</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;attrs_to_fix&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="n">df_t</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">component</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;s_t&quot;</span><span class="p">)[</span><span class="n">missing_attr</span><span class="p">]</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">df_t</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="n">base_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">paid</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_paid_off&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_t</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="p">]</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                <span class="n">df_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">base_cols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_paid_off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_t</span><span class="p">[</span><span class="n">base_cols</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                    <span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;_paid_off&quot;</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="k">if</span> <span class="s2">&quot;biomass&quot;</span> <span class="ow">in</span> <span class="n">paid_off</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="s2">&quot;biomass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">_add_paidoff_biomass</span><span class="p">(</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">network</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="n">costs</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="n">paid_off</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;biomass&quot;</span><span class="p">,</span> <span class="s2">&quot;p_nom_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">tech_group</span><span class="o">=</span><span class="n">paid_off</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;biomass&quot;</span><span class="p">,</span> <span class="s2">&quot;tech_group&quot;</span><span class="p">],</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.add_power_capacities_installed_before_baseyear" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_power_capacities_installed_before_baseyear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">installed_capacities</span><span class="p">,</span> <span class="n">eff_penalty_hist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add existing power capacities to the network.
Note: hydro dams brownfield handled by prepare_network</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="pypsa.Network">Network</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the network</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>costs</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>techno-economic data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>configuration dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>installed_capacities</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>installed capacities in MW</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eff_penalty_hist</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>efficiency penalty for historical plants (1-x)*current</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_power_capacities_installed_before_baseyear</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">n</span><span class="p">:</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">costs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">installed_capacities</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">eff_penalty_hist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Add existing power capacities to the network.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Note: hydro dams brownfield handled by prepare_network</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        n (pypsa.Network): the network</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        costs (pd.DataFrame): techno-economic data</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        config (dict): configuration dictionary</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        installed_capacities (pd.DataFrame): installed capacities in MW</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        eff_penalty_hist (float): efficiency penalty for historical plants (1-x)*current</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;adding power capacities installed before baseyear&quot;</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">installed_capacities</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="c1"># fix fuel type CHP order to match network</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tech_clean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^CHP (.+)$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1 CHP&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tech_clean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tech_clean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;central &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tech_clean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tech_clean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;decentral &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="c1"># TODO fix this based on config / centralise / other</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">carrier_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="s2">&quot;coal&quot;</span><span class="p">:</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="s2">&quot;coal power plant&quot;</span><span class="p">:</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="s2">&quot;CHP coal&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="s2">&quot;coal CHP&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="s2">&quot;CHP gas&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP gas&quot;</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="s2">&quot;gas CHP&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP gas&quot;</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="s2">&quot;gas OCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;gas OCGT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="s2">&quot;gas CCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;gas CCGT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="s2">&quot;solar&quot;</span><span class="p">:</span> <span class="s2">&quot;solar&quot;</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="s2">&quot;solar thermal&quot;</span><span class="p">:</span> <span class="s2">&quot;solar thermal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="s2">&quot;onwind&quot;</span><span class="p">:</span> <span class="s2">&quot;onwind&quot;</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="s2">&quot;offwind&quot;</span><span class="p">:</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="s2">&quot;coal boiler&quot;</span><span class="p">:</span> <span class="s2">&quot;coal boiler central&quot;</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="s2">&quot;ground-sourced heat pump&quot;</span><span class="p">:</span> <span class="s2">&quot;heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="s2">&quot;ground heat pump&quot;</span><span class="p">:</span> <span class="s2">&quot;heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="s2">&quot;air heat pump&quot;</span><span class="p">:</span> <span class="s2">&quot;heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="s2">&quot;nuclear&quot;</span><span class="p">:</span> <span class="s2">&quot;nuclear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="s2">&quot;PHS&quot;</span><span class="p">:</span> <span class="s2">&quot;PHS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="s2">&quot;biomass&quot;</span><span class="p">:</span> <span class="s2">&quot;biomass&quot;</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="p">}</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">costs_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="s2">&quot;coal power plant&quot;</span><span class="p">:</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="s2">&quot;coal CHP&quot;</span><span class="p">:</span> <span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="s2">&quot;gas CHP&quot;</span><span class="p">:</span> <span class="s2">&quot;central gas CHP&quot;</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="s2">&quot;gas OCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;OCGT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="s2">&quot;gas CCGT&quot;</span><span class="p">:</span> <span class="s2">&quot;CCGT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="s2">&quot;solar&quot;</span><span class="p">:</span> <span class="s2">&quot;solar&quot;</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="s2">&quot;solar thermal&quot;</span><span class="p">:</span> <span class="s2">&quot;central solar thermal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="s2">&quot;onwind&quot;</span><span class="p">:</span> <span class="s2">&quot;onwind&quot;</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="s2">&quot;offwind&quot;</span><span class="p">:</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="s2">&quot;coal boiler&quot;</span><span class="p">:</span> <span class="s2">&quot;central coal boiler&quot;</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="s2">&quot;heat pump&quot;</span><span class="p">:</span> <span class="s2">&quot;central ground-sourced heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="s2">&quot;ground-sourced heat pump&quot;</span><span class="p">:</span> <span class="s2">&quot;central ground-sourced heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="s2">&quot;nuclear&quot;</span><span class="p">:</span> <span class="s2">&quot;nuclear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="s2">&quot;biomass&quot;</span><span class="p">:</span> <span class="s2">&quot;biomass&quot;</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="p">}</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="c1"># add techs that may have a direct match to the technoecon data</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">missing_techs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">Fueltype</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">costs_map</span><span class="p">}</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">costs_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">missing_techs</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="k">if</span> <span class="s2">&quot;resource_class&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;resource_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">df</span><span class="o">.</span><span class="n">resource_class</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">grouping_year</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="c1"># TODO: exclude collapse of coal &amp; coal CHP IF CCS retrofitting is enabled</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;existing_capacities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;collapse_years&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">df</span><span class="o">.</span><span class="n">grouping_year</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 0 is default</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">df</span><span class="o">.</span><span class="n">grouping_year</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">grouping_year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;grouping_year&quot;</span><span class="p">,</span> <span class="s2">&quot;tech_clean&quot;</span><span class="p">,</span> <span class="s2">&quot;resource_class&quot;</span><span class="p">],</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;bus&quot;</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">values</span><span class="o">=</span><span class="s2">&quot;Capacity&quot;</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">df_</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">defined_carriers</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">vre_carriers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;solar&quot;</span><span class="p">,</span> <span class="s2">&quot;onwind&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">]</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="c1"># TODO do we really need to loop over the years? / so many things?</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="c1"># something like df_.unstack(level=0) would be more efficient</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="k">for</span> <span class="n">grouping_year</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">resource_grade</span> <span class="ow">in</span> <span class="n">df_</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">build_year</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">grouping_year</span> <span class="o">==</span> <span class="s2">&quot;brownwfield&quot;</span> <span class="k">else</span> <span class="n">grouping_year</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding existing generator </span><span class="si">{</span><span class="n">generator</span><span class="si">}</span><span class="s2"> with year grp </span><span class="si">{</span><span class="n">grouping_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">if</span> <span class="n">carrier_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defined_carriers</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="sa">f</span><span class="s2">&quot;Carrier </span><span class="si">{</span><span class="n">carrier_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span><span class="w"> </span><span class="kc">None</span><span class="p">)</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">generator</span><span class="si">}</span><span class="s2"> not defined in network&quot;</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="s2">&quot;Consider adding to the CARRIER_MAP&quot;</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">elif</span> <span class="n">costs_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">generator</span><span class="si">}</span><span class="s2"> not defined in technoecon map - check costs_map&quot;</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="c1"># capacity is the capacity in MW at each node for this</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">capacity</span> <span class="o">=</span> <span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grouping_year</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">resource_grade</span><span class="p">]</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">if</span> <span class="n">capacity</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">continue</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span><span class="p">[</span><span class="n">capacity</span> <span class="o">&gt;</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;existing_capacities&quot;</span><span class="p">][</span><span class="s2">&quot;threshold_capacity&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">buses</span> <span class="o">=</span> <span class="n">capacity</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="c1"># fix index for network.add (merge grade to name)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">if</span> <span class="n">resource_grade</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">capacity</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">resource_grade</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">capacity</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">costs_map</span><span class="p">[</span><span class="n">generator</span><span class="p">]</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">costs_key</span> <span class="o">=</span> <span class="n">costs_map</span><span class="p">[</span><span class="n">generator</span><span class="p">]</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">if</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">vre_carriers</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="p">)</span> <span class="o">==</span> <span class="n">generator</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">p_max_pu</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">grouping_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">bus</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">p_max_pu</span><span class="o">=</span><span class="n">p_max_pu</span><span class="p">[</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">],</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nuclear&quot;</span><span class="p">,</span> <span class="s2">&quot;coal power plant&quot;</span><span class="p">,</span> <span class="s2">&quot;biomass&quot;</span><span class="p">,</span> <span class="s2">&quot;oil&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">),</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="n">bus</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">p_max_pu</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;nuclear_reactors&quot;</span><span class="p">][</span><span class="s2">&quot;p_max_pu&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">generator</span> <span class="o">==</span> <span class="s2">&quot;nuclear&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="n">p_min_pu</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;nuclear_reactors&quot;</span><span class="p">][</span><span class="s2">&quot;p_min_pu&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">generator</span> <span class="o">==</span> <span class="s2">&quot;nuclear&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eff_penalty_hist</span><span class="p">),</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="c1"># TODO this does not add the carrier to the list</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gas CCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;gas OCGT&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="n">bus0</span> <span class="o">=</span> <span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; gas&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="n">carrier_</span> <span class="o">=</span> <span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">]</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="c1"># ugly fix to register the carrier. Emissions for sub carrier are 0: they are accounted for at gas bus</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">carrier_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                <span class="s2">&quot;co2_emissions&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;plotting&quot;</span><span class="p">][</span><span class="s2">&quot;tech_colors&quot;</span><span class="p">][</span><span class="n">carrier_</span><span class="p">],</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="s2">&quot;nice_name&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;plotting&quot;</span><span class="p">][</span><span class="s2">&quot;nice_names&quot;</span><span class="p">][</span><span class="n">carrier_</span><span class="p">],</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="s2">&quot;max_growth&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="s2">&quot;max_relative_growth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="p">}</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="c1"># now add link - carrier should exist</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">),</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>  <span class="c1"># NB: VOM is per MWel</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="c1"># NB: fixed cost is per MWel</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eff_penalty_hist</span><span class="p">),</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">costs_key</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="s2">&quot;solar thermal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="s2">&quot;CHP coal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="s2">&quot;CHP gas&quot;</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="s2">&quot;heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="s2">&quot;coal boiler&quot;</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;heat_coupling&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped </span><span class="si">{</span><span class="n">generator</span><span class="si">}</span><span class="s2"> because heat coupling is not activated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="o">==</span> <span class="s2">&quot;solar thermal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">p_max_pu</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">p_max_pu</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">capacity</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                <span class="n">bus</span><span class="o">=</span><span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; central heat&quot;</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central &quot;</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="n">p_max_pu</span><span class="o">=</span><span class="n">p_max_pu</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central &quot;</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CHP coal&quot;</span><span class="p">,</span> <span class="s2">&quot;coal CHP&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="n">bus0</span> <span class="o">=</span> <span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; coal fuel&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot; generator-</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>  <span class="c1"># NB: VOM is per MWel</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eff_penalty_hist</span><span class="p">),</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="n">heat_to_power</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;coal&quot;</span><span class="p">][</span><span class="s2">&quot;heat_to_power&quot;</span><span class="p">],</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="c1"># simplified treatment based on a decrease with c_v and a max htpwr ratio</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="n">htpr</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;coal&quot;</span><span class="p">][</span><span class="s2">&quot;heat_to_power&quot;</span><span class="p">]</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot; boiler-</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; central heat&quot;</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>  <span class="c1"># NB: VOM is per MWel</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="c1"># p_max will be constrained by chp constraints</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="c1"># total eff will be fixed by CHP constraints</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;coal&quot;</span><span class="p">][</span><span class="s2">&quot;total_eff&quot;</span><span class="p">],</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central coal CHP&quot;</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CHP gas&quot;</span><span class="p">,</span> <span class="s2">&quot;gas CHP&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">bus0</span> <span class="o">=</span> <span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; gas&quot;</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot; generator-</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>  <span class="c1"># NB: VOM is per MWel</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>  <span class="c1"># NB: fixed cost is per MWel,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eff_penalty_hist</span><span class="p">),</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                <span class="n">heat_to_power</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;gas&quot;</span><span class="p">][</span><span class="s2">&quot;heat_to_power&quot;</span><span class="p">],</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="c1"># simplified treatment based on a decrease with c_v and a max htpwr ratio</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="n">htpr</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;gas&quot;</span><span class="p">][</span><span class="s2">&quot;heat_to_power&quot;</span><span class="p">]</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot; boiler-</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; central heat&quot;</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>  <span class="c1"># NB: VOM is per MWel</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="c1"># pmax will be constrained by chp constraints</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">htpr</span><span class="p">,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="c1"># will be constrained by chp constraints</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chp_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;gas&quot;</span><span class="p">][</span><span class="s2">&quot;total_eff&quot;</span><span class="p">],</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;central gas CHP CC&quot;</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">elif</span> <span class="n">generator</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;coal boiler&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">bus0</span> <span class="o">=</span> <span class="n">buses</span> <span class="o">+</span> <span class="s2">&quot; coal&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot;central&quot;</span> <span class="k">if</span> <span class="n">generator</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;decentral&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;decentral&quot;</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">cat</span> <span class="o">+</span> <span class="n">generator</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">),</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">bus0</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">cat</span> <span class="o">+</span> <span class="s2">&quot;heat&quot;</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">carrier</span><span class="o">=</span><span class="n">carrier_map</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;VOM&quot;</span><span class="p">],</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">generator</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="c1"># TODO fix read operation in func, fix snakemake in function, make air pumps?</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="o">==</span> <span class="s2">&quot;heat pump&quot;</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="c1"># TODO separate the read operation from the add operation</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">cop_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                <span class="n">gshp_cop</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;gshp_cop_profiles&quot;</span><span class="p">]</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="n">gshp_cop</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gshp_cop</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                <span class="n">gshp_cop</span> <span class="o">=</span> <span class="n">shift_profile_to_planning_year</span><span class="p">(</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                    <span class="n">gshp_cop</span><span class="p">,</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">planning_horizons</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                <span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                <span class="n">gshp_cop</span> <span class="o">=</span> <span class="n">gshp_cop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span><span class="p">]</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                <span class="s2">&quot;Link&quot;</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>                <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">),</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>                <span class="n">bus0</span><span class="o">=</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="n">bus1</span><span class="o">=</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="s2">&quot; central heat&quot;</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;heat pump&quot;</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>                <span class="n">efficiency</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>                    <span class="n">gshp_cop</span><span class="p">[</span><span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>                    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_dep_hp_cop&quot;</span><span class="p">]</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>                    <span class="k">else</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>                <span class="p">),</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span> <span class="o">/</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="n">build_year</span><span class="o">=</span><span class="n">build_year</span><span class="p">,</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                <span class="n">lifetime</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;decentral ground-sourced heat pump&quot;</span><span class="p">,</span> <span class="s2">&quot;lifetime&quot;</span><span class="p">],</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="k">elif</span> <span class="n">generator</span> <span class="o">==</span> <span class="s2">&quot;PHS&quot;</span><span class="p">:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="c1"># pure pumped hydro storage, fixed, 6h energy by default, no inflow</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>                <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                <span class="n">capacity</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grouping_year</span><span class="p">),</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                <span class="n">bus</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>                <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;PHS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>                <span class="n">p_nom</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                <span class="n">p_nom_min</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="n">p_nom_max</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="n">max_hours</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;hydro&quot;</span><span class="p">][</span><span class="s2">&quot;PHS_max_hours&quot;</span><span class="p">],</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                <span class="n">efficiency_store</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;PHS&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;PHS&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="n">marginal_cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="n">location</span><span class="o">=</span><span class="n">buses</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>            <span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                <span class="sa">f</span><span class="s2">&quot;Skipped existing capacitity for &#39;</span><span class="si">{</span><span class="n">generator</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="o">+</span> <span class="s2">&quot; - tech not implemented as existing capacity&quot;</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="p">)</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.distribute_vre_by_grade" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distribute_vre_by_grade</span><span class="p">(</span><span class="n">cap_by_year</span><span class="p">,</span> <span class="n">grade_capacities</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Distribute VRE capacities by grade, ensuring potentials are respected and prioritizing better grades first</p>
<p>Allocates variable renewable energy (VRE) capacity additions across different
resource quality grades. The algorithm preferentially uses higher-quality
grades before moving to lower-quality ones, implementing a "fill-up" strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cap_by_year</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annual VRE capacity additions indexed by year. Values represent
the total capacity to be added in each year (MW or GW).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grade_capacities</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Available capacity potential by resource grade for a bus,
indexed by grade identifier. Higher-quality grades should have lower indices for
proper prioritization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with distributed capacities where:
- Rows are indexed by years (from cap_by_year)
- Columns are indexed by grades (from grade_capacities)
- Values represent allocated capacity for each year-grade combination</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>cap_additions = pd.Series([100, 200], index=[2020, 2030])
grade_potentials = pd.Series([50, 75, 100], index=['grade_1', 'grade_2', 'grade_3'])
result = distribute_vre_by_grade(cap_additions, grade_potentials)
print(result.sum(axis=1))  # Should match original yearly totals</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="note" open>
  <summary>Note</summary>
  <p>The function assumes grade_capacities are ordered with best grades first.
If total demand exceeds available capacity, the algorithm allocates as much
as possible following the grade priority.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">distribute_vre_by_grade</span><span class="p">(</span><span class="n">cap_by_year</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">grade_capacities</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Distribute VRE capacities by grade, ensuring potentials are respected and prioritizing better grades first</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Allocates variable renewable energy (VRE) capacity additions across different</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    resource quality grades. The algorithm preferentially uses higher-quality</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    grades before moving to lower-quality ones, implementing a &quot;fill-up&quot; strategy.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        cap_by_year (pd.Series): Annual VRE capacity additions indexed by year. Values represent</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            the total capacity to be added in each year (MW or GW).</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        grade_capacities (pd.Series): Available capacity potential by resource grade for a bus,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            indexed by grade identifier. Higher-quality grades should have lower indices for</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            proper prioritization.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        DataFrame with distributed capacities where:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            - Rows are indexed by years (from cap_by_year)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            - Columns are indexed by grades (from grade_capacities)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            - Values represent allocated capacity for each year-grade combination</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        &gt;&gt;&gt; cap_additions = pd.Series([100, 200], index=[2020, 2030])</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        &gt;&gt;&gt; grade_potentials = pd.Series([50, 75, 100], index=[&#39;grade_1&#39;, &#39;grade_2&#39;, &#39;grade_3&#39;])</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        &gt;&gt;&gt; result = distribute_vre_by_grade(cap_additions, grade_potentials)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        &gt;&gt;&gt; print(result.sum(axis=1))  # Should match original yearly totals</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        The function assumes grade_capacities are ordered with best grades first.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        If total demand exceeds available capacity, the algorithm allocates as much</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        as possible following the grade priority.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">availability</span> <span class="o">=</span> <span class="n">cap_by_year</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">to_distribute</span> <span class="o">=</span> <span class="n">grade_capacities</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">n_years</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_distribute</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">n_sources</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">availability</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="c1"># To store allocation per year per source (shape: sources x years)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">allocation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_sources</span><span class="p">,</span> <span class="n">n_years</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">remaining</span> <span class="o">=</span> <span class="n">availability</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_years</span><span class="p">):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">needed</span> <span class="o">=</span> <span class="n">to_distribute</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">used_up</span> <span class="o">=</span> <span class="n">cumsum</span> <span class="o">&lt;</span> <span class="n">needed</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumsum</span> <span class="o">&gt;=</span> <span class="n">needed</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">allocation</span><span class="p">[</span><span class="n">used_up</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining</span><span class="p">[</span><span class="n">used_up</span><span class="p">]</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="n">needed</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">[</span><span class="n">cutoff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">cutoff</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">allocation</span><span class="p">[</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">needed</span> <span class="o">-</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">[</span><span class="n">cutoff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">cutoff</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="c1"># Subtract what was used from availability</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">remaining</span> <span class="o">-=</span> <span class="n">allocation</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">allocation</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">grade_capacities</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">availability</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="add_existing_baseyear.filter_brownfield_capacities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_brownfield_capacities</span><span class="p">(</span><span class="n">existing_df</span><span class="p">,</span> <span class="n">plan_year</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Filter brownfield capacities to remove retired/not yet built plants .
Parameters:
    existing_df (pd.DataFrame): DataFrame containing asset information with at least the columns 'DateOut', 'DateIn', 'grouping_year', and 'cluster_bus'.
    plan_year (int): The year modelled year/horizon
Returns:
    pd.DataFrame: The filtered and updated DataFrame.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>workflow/scripts/add_existing_baseyear.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_brownfield_capacities</span><span class="p">(</span><span class="n">existing_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">plan_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    Filter brownfield capacities to remove retired/not yet built plants .</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">        existing_df (pd.DataFrame): DataFrame containing asset information with at least the columns &#39;DateOut&#39;, &#39;DateIn&#39;, &#39;grouping_year&#39;, and &#39;cluster_bus&#39;.</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        plan_year (int): The year modelled year/horizon</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">        pd.DataFrame: The filtered and updated DataFrame.</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="c1"># drop assets which are already phased out / decommissioned</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="n">phased_out</span> <span class="o">=</span> <span class="n">existing_df</span><span class="p">[</span><span class="n">existing_df</span><span class="p">[</span><span class="s2">&quot;DateOut&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">plan_year</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>    <span class="n">existing_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">phased_out</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="n">to_drop</span> <span class="o">=</span> <span class="n">existing_df</span><span class="p">[</span><span class="n">existing_df</span><span class="o">.</span><span class="n">DateIn</span> <span class="o">&gt;</span> <span class="n">plan_year</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="n">existing_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="n">existing_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cluster_bus&quot;</span><span class="p">:</span> <span class="s2">&quot;bus&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>    <span class="k">return</span> <span class="n">existing_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../add_electricity/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Add electricity">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Add electricity
              </div>
            </div>
          </a>
        
        
          
          <a href="../add_sectors/" class="md-footer__link md-footer__link--next" aria-label="Next: Add sectors">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Add sectors
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Potsdam Institute for Climate Impact Research (PIK) 2024
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/pik-piam/PyPSA-China-PIK" target="_blank" rel="noopener" title="PyPSA-China-PIK on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.footer"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>